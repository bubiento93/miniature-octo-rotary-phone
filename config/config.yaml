# ═══════════════════════════════════════════════════════════════
#                    TrendRadar 配置文件
#                      Version: 2.0.0
# ═══════════════════════════════════════════════════════════════
# 可视化配置编辑器地址: https://sansan0.github.io/TrendRadar/
# ===============================================================
# 1. 基础设置
# ===============================================================
app:
  timezone: "Asia/Shanghai"
  show_version_update: true
# ===============================================================
# 1.5 调度系统
# ===============================================================
schedule:
  enabled: true
  preset:  "morning_evening"
# ===============================================================
# 2. 数据源 - 热榜平台
# ===============================================================
platforms:
  enabled: true
  sources:
    - id: "toutiao"
      name: "今日头条"
    - id: "baidu"
      name: "百度热搜"
    - id: "wallstreetcn-hot"
      name: "华尔街见闻"
    - id: "sputniknewscn"
      name: "卫星通讯社"
    - id: "zaobao"
      name: "联合早报"
    - id: "zhihu"
      name: "知乎"
    - id: "36kr"
      name: "36氪"
    - id: "thepaper"
      name: "澎湃新闻"
    - id: "jin10"
      name: "金十数据"
    - id: "ifeng"
      name: "凤凰网"
    - id: "douyin"
      name: "抖音"
    - id: "mktnews"
      name: "MKT新闻"
# ===============================================================
# 3. 数据源 - RSS 订阅（修正层级，无重复）
# ===============================================================
rss:
  enabled: true
  freshness_filter:
    enabled: true
    max_age_days: 1
  feeds:
    - id: "ruanyifeng"
      name: "阮一峰的网络日志"
      url: "http://www.ruanyifeng.com/blog/atom.xml"
      enabled: true
    - id: "yahoo-finance"
      name: "雅虎财经"
      url: "https://finance.yahoo.com/news/rssindex"
      max_age_days: 3
      enabled: true
    - id: "TASS"
      name: "塔斯社"
      url: "http://tass.com/rss/v2.xml"
      max_age_days: 3
      enabled: false
    - id: "HBR IdeaCast"
      name: "哈佛商业评论"
      url: "http://feeds.harvardbusiness.org/harvardbusiness/ideacast"
      max_age_days: 3
      enabled: true
    - id: "NYT"
      name: "纽约时报"
      url: "https://rss.nytimes.com/services/xml/rss/nyt/World.xml"
      max_age_days: 3
    - id: "BBC News - World"
      name: "BBC英国"
      url: "http://feeds.bbci.co.uk/news/world/rss.xml"
      max_age_days: 3

    - id: "people new"
      name: "人民日报"
      url: "https://rsshub.app/people"
      max_age_days: 3

# ===============================================================
# 4. 报告模式（修正重复，层级正确）
# ===============================================================
report:
  show_keyword_label: true  # 显示分组专属标签（如「企业与品牌」），高亮分组
  dedup_across_platforms: true  # 跨平台分组内去重，同分组不重复
  group_separator: "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"  # 分组之间加分隔线
  incremental:
    dedup_across_platforms: true       # 跨平台增量去重（不同平台同新闻算一条）
    keep_original: true               # 保留原平台数据最全的那条
  sort_by_position_first: false
  rank_threshold: 5                   # 排名高亮阈值
  max_news_per_keyword: 0             # 每个关键词最大显示数量（0=不限制）
  mode: "incremental"  # 核心：启用增量推送模式

# ===============================================================
# 5. 推送内容控制
# ===============================================================
display:
  region_order:
    - new_items                       # 1️⃣ 新增热点区域
    - hotlist                         # 2️⃣ 热榜区域（关键词匹配）
    - rss                             # 3️⃣ RSS 订阅区域
    - standalone                      # 4️⃣ 独立展示区
    - ai_analysis                     # 5️⃣ AI 分析区域
  regions:
    new_items: false # 新增热点区域（含热榜新增 + RSS 新增）
    hotlist: true # 热榜区域（关键词匹配的热点新闻）
    rss: true # RSS 订阅区域
    standalone: true # 独立展示区开关
    ai_analysis: true # AI 分析区域开关

# ===============================================================
# 独立展示区配置（合并所有重复定义，只保留一个）
# ===============================================================
standalone:
  enable: true
  max_items_per_source: 5
  group_by: keyword
  keyword_whitelist: []
  sort_by: rank
  show_platform: true
  show_rank: true
  show_time: true
  dedup: true
  match_global_filter: true
  # 先修正 include_platforms（格式规范，元素间加空格）
  include_platforms: ["zhihu", "wallstreetcn-hot", "bilibili-hot-search", "thepaper", "cls-hot", "toutiao", "baidu", "ifeng", "weibo", "tieba", "douyin"]
  # 核心修复第137行的 include_rss（补充所有缺失的逗号，规范格式）
  include_rss: ["hacker-news", "ruanyifeng", "yahoo-finance", "TASS", "HBR IdeaCast", "NYT", "BBC News - World", "people news"]
  max_items: 10
  show_keyword_label: true

# ===============================================================
# 7. 推送通知
# ===============================================================
notification:
  enabled: true
  channels:
    feishu:
      webhook_url: ""
    dingtalk:
      webhook_url: ""
    wework:
      webhook_url: ""
      msg_type: "markdown"
    telegram:
      bot_token: ""
      chat_id: ""
    email:
      from: ""
      password: ""
      to: ""
      smtp_server: ""
      smtp_port: ""
    ntfy:
      server_url: "https://ntfy.sh"
      topic: ""
      token: ""
    bark:
      url: ""
    slack:
      webhook_url: ""
    generic_webhook:
      webhook_url: ""
      payload_template: ""
# ===============================================================
# 8. 内容去重
# ===============================================================
deduplication:
  enabled: true                      # 开启全局去重
  mode: "content_hash"               # 去重依据：content_hash(内容指纹，精准去重)
  keep_strategy: "max_data"          # 保留策略：max_data(数据字段最多的新闻)
  time_window: 24                    # 24小时内同事件只保留一条
  min_similarity: 0.8                # 调低阈值，减少漏判
  ignore_title_suffix: true          # 忽略标题后缀（如【最新】/快讯等）
  ignore_html_tags: true             # 新增：忽略HTML标签干扰（如<p>/<br>）

# ===============================================================
# 9. 存储配置
# ===============================================================
storage:
  backend: "auto"
  formats:
    sqlite: true
    txt: false
    html: true
  local:
    data_dir: "output"
    retention_days: 0
  remote:
    retention_days: 15
    endpoint_url: ""
    bucket_name: ""
    access_key_id: ""
    secret_access_key: ""
    region: ""
  pull:
    enabled: false
    days: 7
# ===============================================================
# 10. AI 模型配置（共享）- 层级正确，无错位
# ===============================================================
ai:
  model: "deepseek/deepseek-chat"
  api_key: "sk-1f20f04693784257bb1f7cbaa6cc1fba"
  api_base: ""
  timeout: 120
  temperature: 0.5
  max_tokens: 5000
  num_retries: 2
  fallback_models: []
# ===============================================================
# 11. AI 分析功能（核心修复：层级正确，无嵌套）
# ===============================================================
ai_analysis:
  enabled: true                     # 是否启用 AI 分析（总开关）
  language: "Chinese"
  prompt_file: "ai_analysis_prompt.txt"
  mode: "incremental"
  max_news_for_analysis: 150
  include_rss: true
  include_standalone: true
  include_rank_timeline: true
  dedup_before_analysis: true
  keep_max_info: true
  analyze_push_data: true
  max_news_count: 12
  analysis_mode: follow_report
  pass_timeline: false

# ===============================================================
# 12. AI 翻译功能（核心修复：顶级配置，无嵌套，缩进正确）
# ===============================================================
ai_translation:
  enabled: true
  language: "Chinese"
  prompt_file: "ai_translation_prompt.txt"
  translate_scope:
    hotlist: true
    rss: true
    standalone: true
    title_only: false
  rss_translate:
    force_translate: true
    keep_original: false
    translate_description: true
# ===============================================================
# 13. 高级设置
# ===============================================================
# 11. 高级设置（补充RSS新鲜度过滤）
# ===============================================================
advanced:
  debug: false
  version_check_url: "https://raw.githubusercontent.com/sansan0/TrendRadar/refs/heads/master/version"
  mcp_version_check_url: "https://raw.githubusercontent.com/sansan0/TrendRadar/refs/heads/master/version_mcp"
  configs_version_check_url: "https://raw.githubusercontent.com/sansan0/TrendRadar/refs/heads/master/version_configs"
  crawler:
    request_interval: 2000            # 请求间隔（毫秒）
    use_proxy: false                  # 是否启用代理
    default_proxy: "http://127.0.0.1:10801"
  rss:
    request_interval: 1000            # 请求间隔（毫秒）
    timeout: 15                       # 请求超时（秒）
    use_proxy: false                  # 是否使用代理
    proxy_url: ""                     # RSS 专属代理（留空则使用 crawler.default_proxy）
    freshness_filter:  # 新增：RSS 24小时新鲜度过滤
      enabled: true
      max_age_days: 1                 # 仅推送24小时内发布的RSS文章
    headers:  # 新增的请求头（缩进4个空格，和上面的freshness_filter同级）
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36 Edg/121.0.0.0"
      Referer: "https://rsshub.app/"
      Accept: "application/rss+xml,application/xml;q=0.9,*/*;q=0.8"
      Accept-Language: "zh-CN,zh;q=0.9,en;q=0.8"
      Cache-Control: "no-cache"
      Pragma: "no-cache"
  weight:
    rank: 0.6                         # 排名权重
    frequency: 0.3                    # 频次权重
    hotness: 0.1                      # 热度权重
  max_accounts_per_channel: 3         # 每个渠道最大账号数量
  batch_size:
    default: 4000
    dingtalk: 20000
    feishu: 30000
    bark: 4000
    slack: 4000
  batch_send_interval: 3              # 批次发送间隔（秒）
  feishu_message_separator: "━━━━━━━━━━━━━━━━"
